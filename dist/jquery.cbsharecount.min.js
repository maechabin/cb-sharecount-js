!function(a){"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery"),window,document):a(jQuery,window,document)}(function(a,b,c,d){"use strict";var e=function(b,c){this.element=b,this.$element=a(b),this.site_url="",this.api_url="",this.param_name="",this.send_data={},this.num=c};e.prototype.data={facebook:{api_url:"http://graph.facebook.com/",param_name:"id",count:0},hatena:{api_url:"http://api.b.st-hatena.com/entry.count",param_name:"url",count:0}},e.prototype.getCount=function(){var b=new a.Deferred;return a.ajax({type:"get",url:this.api_url,cache:!0,dataType:"jsonp",data:this.send_data,success:b.resolve,error:b.reject}),b.promise()},e.prototype.view=function(b){var c=this;return a(b).each(function(a){switch(a){case 0:c.data.facebook.count=this[0].shares||this[0].likes||0;break;case 1:c.data.hatena.count=this[0]}}),c.save(),c.render()},e.prototype.render=function(){var b=a(".cb-fb").eq(this.num).find("span"),c=a(".cb-hb").eq(this.num).find("span");b.html(this.data.facebook.count),c.html(this.data.hatena.count)},e.prototype.save=function(){localStorage.setItem("sc_"+this.site_url,JSON.stringify({fbCount:this.data.facebook.count,hbCount:this.data.hatena.count,saveDate:(new Date).getTime()}))},e.prototype.setup=function(){var b=this,c=[];a.each(b.data,function(a,d){b.api_url=d.api_url,b.send_data[d.param_name]=b.site_url,c.push(b.getCount())}),a.when.apply(a,c).done(function(){return b.view(arguments)})},e.prototype.checkCache=function(){var a=JSON.parse(localStorage.getItem("sc_"+this.site_url))||null,b=(new Date).getTime();return a&&b-a.saveDate<864e5?(this.data.facebook.count=a.fbCount,this.data.hatena.count=a.hbCount,this.render()):this.setup()},e.prototype.init=function(){return this.site_url=this.$element.attr("title"),this.checkCache(),this},a.fn.cbShareCount=function(){return this.each(function(a){new e(this,a).init()})}});